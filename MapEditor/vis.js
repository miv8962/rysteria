// Copyright (C) 2024 Paul Johnson
// Copyright (C) 2024-2025 Maxim Nesterov

// This program is free software: you can redistribute it and/or modify
// it under the terms of the GNU Affero General Public License as
// published by the Free Software Foundation, either version 3 of the
// License, or (at your option) any later version.

// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU Affero General Public License for more details.

// You should have received a copy of the GNU Affero General Public License
// along with this program.  If not, see <https://www.gnu.org/licenses/>.

const ds = [
    [
        null,
        null,
        null,
        null,
        null,
        133,
        132,
        131,
        130,
        null,
        null,
        null,
        null,
        null,
        122,
        121,
        120,
        119,
        118,
        117,
        116,
        117,
        118,
        119,
        120,
        121,
        122,
        123,
        124,
        125,
        126,
        127,
        128,
        129,
        130,
        null,
        null,
        null,
        null,
        null
    ],
    [
        null,
        140,
        139,
        null,
        null,
        null,
        null,
        130,
        129,
        128,
        127,
        126,
        125,
        124,
        123,
        null,
        null,
        null,
        null,
        null,
        115,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        129,
        130,
        131,
        132,
        133,
        null,
        null,
        null
    ],
    [
        140,
        139,
        138,
        137,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        126,
        null,
        null,
        null,
        null,
        119,
        118,
        null,
        114,
        113,
        112,
        null,
        110,
        109,
        108,
        107,
        106,
        105,
        null,
        null,
        null,
        null,
        132,
        133,
        134,
        135,
        null,
        null
    ],
    [
        139,
        138,
        137,
        136,
        135,
        134,
        133,
        132,
        131,
        130,
        129,
        128,
        127,
        null,
        null,
        120,
        119,
        118,
        117,
        116,
        115,
        null,
        111,
        110,
        109,
        null,
        null,
        106,
        105,
        104,
        103,
        104,
        null,
        134,
        133,
        134,
        135,
        136,
        null,
        null
    ],
    [
        140,
        139,
        138,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        122,
        121,
        120,
        119,
        118,
        null,
        116,
        null,
        null,
        109,
        108,
        null,
        null,
        null,
        null,
        103,
        102,
        null,
        null,
        135,
        134,
        135,
        136,
        137,
        138,
        null
    ],
    [
        141,
        140,
        null,
        null,
        null,
        null,
        null,
        14,
        13,
        14,
        null,
        null,
        null,
        null,
        null,
        122,
        121,
        120,
        null,
        null,
        117,
        null,
        null,
        null,
        107,
        null,
        109,
        110,
        null,
        null,
        101,
        null,
        null,
        null,
        135,
        136,
        137,
        null,
        null,
        null
    ],
    [
        142,
        141,
        null,
        null,
        null,
        15,
        14,
        13,
        12,
        13,
        14,
        15,
        16,
        null,
        null,
        null,
        122,
        121,
        null,
        null,
        null,
        null,
        null,
        null,
        106,
        107,
        108,
        109,
        null,
        null,
        100,
        null,
        100,
        null,
        null,
        137,
        null,
        null,
        null,
        null
    ],
    [
        143,
        null,
        null,
        null,
        15,
        14,
        13,
        12,
        11,
        12,
        null,
        null,
        17,
        null,
        null,
        null,
        null,
        122,
        123,
        null,
        null,
        null,
        null,
        null,
        105,
        null,
        109,
        110,
        111,
        null,
        99,
        null,
        99,
        98,
        null,
        null,
        null,
        null,
        null,
        null
    ],
    [
        144,
        null,
        null,
        15,
        14,
        13,
        12,
        11,
        10,
        11,
        null,
        19,
        18,
        17,
        16,
        null,
        null,
        123,
        124,
        125,
        null,
        null,
        null,
        105,
        104,
        null,
        110,
        111,
        112,
        null,
        98,
        null,
        98,
        97,
        96,
        95,
        null,
        null,
        null,
        null
    ],
    [
        145,
        null,
        null,
        16,
        15,
        null,
        11,
        10,
        9,
        null,
        null,
        20,
        null,
        null,
        15,
        null,
        125,
        124,
        125,
        126,
        127,
        128,
        null,
        null,
        103,
        null,
        null,
        112,
        113,
        null,
        97,
        null,
        null,
        96,
        95,
        94,
        93,
        null,
        null,
        null
    ],
    [
        146,
        null,
        null,
        17,
        null,
        null,
        null,
        null,
        8,
        null,
        22,
        21,
        null,
        13,
        14,
        null,
        126,
        125,
        126,
        127,
        128,
        129,
        null,
        null,
        102,
        101,
        null,
        null,
        null,
        null,
        96,
        null,
        null,
        null,
        94,
        93,
        92,
        91,
        null,
        null
    ],
    [
        147,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        7,
        null,
        null,
        null,
        null,
        12,
        null,
        null,
        127,
        null,
        null,
        null,
        null,
        130,
        null,
        null,
        101,
        100,
        99,
        null,
        null,
        96,
        95,
        null,
        null,
        null,
        null,
        null,
        null,
        90,
        null,
        null
    ],
    [
        148,
        null,
        2,
        1,
        2,
        3,
        4,
        5,
        6,
        7,
        8,
        9,
        10,
        11,
        null,
        null,
        128,
        null,
        134,
        null,
        null,
        131,
        null,
        null,
        null,
        99,
        98,
        97,
        96,
        95,
        94,
        null,
        null,
        91,
        90,
        null,
        88,
        89,
        null,
        null
    ],
    [
        149,
        null,
        1,
        0,
        1,
        2,
        3,
        4,
        null,
        null,
        9,
        10,
        11,
        null,
        null,
        null,
        129,
        null,
        133,
        null,
        null,
        132,
        null,
        null,
        null,
        100,
        99,
        null,
        null,
        null,
        93,
        92,
        91,
        90,
        89,
        88,
        87,
        null,
        null,
        null
    ],
    [
        150,
        null,
        2,
        1,
        2,
        null,
        4,
        5,
        null,
        11,
        10,
        11,
        12,
        13,
        null,
        null,
        130,
        131,
        132,
        133,
        134,
        133,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        91,
        90,
        89,
        88,
        87,
        86,
        null,
        null,
        null
    ],
    [
        151,
        null,
        null,
        null,
        null,
        null,
        null,
        6,
        null,
        12,
        11,
        12,
        13,
        14,
        null,
        null,
        null,
        null,
        133,
        134,
        135,
        null,
        null,
        null,
        null,
        null,
        null,
        94,
        93,
        92,
        null,
        null,
        null,
        88,
        null,
        86,
        85,
        null,
        null,
        null
    ],
    [
        152,
        153,
        154,
        155,
        156,
        157,
        null,
        7,
        null,
        null,
        12,
        13,
        14,
        15,
        null,
        19,
        20,
        null,
        null,
        null,
        null,
        null,
        26,
        27,
        28,
        null,
        null,
        null,
        92,
        91,
        90,
        89,
        null,
        87,
        null,
        null,
        84,
        83,
        null,
        null
    ],
    [
        153,
        null,
        null,
        null,
        null,
        158,
        null,
        8,
        9,
        null,
        null,
        null,
        null,
        16,
        17,
        18,
        19,
        20,
        21,
        22,
        23,
        24,
        25,
        null,
        29,
        30,
        31,
        null,
        91,
        90,
        89,
        88,
        87,
        86,
        85,
        null,
        83,
        82,
        81,
        null
    ],
    [
        154,
        155,
        null,
        161,
        160,
        159,
        null,
        null,
        10,
        11,
        12,
        13,
        null,
        null,
        null,
        null,
        null,
        null,
        22,
        23,
        null,
        null,
        26,
        null,
        null,
        null,
        32,
        null,
        null,
        91,
        90,
        89,
        null,
        null,
        84,
        83,
        82,
        81,
        80,
        null
    ],
    [
        null,
        156,
        null,
        null,
        161,
        160,
        null,
        12,
        11,
        null,
        null,
        14,
        15,
        16,
        17,
        null,
        21,
        22,
        23,
        24,
        null,
        null,
        27,
        28,
        null,
        null,
        33,
        null,
        null,
        null,
        91,
        90,
        91,
        null,
        null,
        82,
        81,
        80,
        79,
        null
    ],
    [
        null,
        157,
        158,
        159,
        160,
        null,
        null,
        13,
        12,
        null,
        null,
        15,
        16,
        17,
        18,
        19,
        20,
        21,
        22,
        23,
        null,
        null,
        null,
        29,
        30,
        31,
        32,
        33,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        78,
        null
    ],
    [
        159,
        158,
        null,
        null,
        null,
        null,
        null,
        14,
        13,
        14,
        null,
        16,
        17,
        null,
        19,
        20,
        null,
        null,
        23,
        24,
        25,
        null,
        null,
        null,
        null,
        null,
        33,
        34,
        35,
        36,
        37,
        null,
        null,
        null,
        null,
        48,
        null,
        null,
        77,
        null
    ],
    [
        160,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        14,
        15,
        null,
        17,
        null,
        null,
        20,
        21,
        22,
        null,
        null,
        25,
        26,
        27,
        28,
        null,
        null,
        null,
        34,
        35,
        null,
        37,
        38,
        39,
        null,
        null,
        46,
        47,
        48,
        null,
        76,
        null
    ],
    [
        161,
        null,
        null,
        null,
        57,
        58,
        59,
        null,
        null,
        16,
        null,
        18,
        null,
        null,
        21,
        22,
        23,
        null,
        null,
        26,
        null,
        28,
        29,
        30,
        null,
        null,
        35,
        null,
        null,
        null,
        null,
        40,
        null,
        44,
        45,
        46,
        47,
        null,
        75,
        null
    ],
    [
        162,
        null,
        null,
        57,
        56,
        57,
        58,
        59,
        null,
        null,
        null,
        19,
        null,
        null,
        null,
        23,
        24,
        null,
        28,
        27,
        null,
        29,
        30,
        31,
        null,
        37,
        36,
        null,
        50,
        null,
        null,
        41,
        42,
        43,
        44,
        45,
        null,
        null,
        74,
        null
    ],
    [
        163,
        null,
        57,
        56,
        55,
        56,
        57,
        58,
        null,
        null,
        null,
        20,
        null,
        null,
        null,
        24,
        25,
        null,
        29,
        28,
        null,
        30,
        31,
        null,
        null,
        38,
        null,
        null,
        49,
        48,
        null,
        42,
        null,
        null,
        null,
        null,
        null,
        null,
        73,
        null
    ],
    [
        164,
        null,
        56,
        55,
        54,
        55,
        56,
        57,
        null,
        null,
        null,
        21,
        22,
        23,
        null,
        null,
        26,
        null,
        30,
        29,
        null,
        null,
        32,
        null,
        null,
        39,
        null,
        null,
        48,
        47,
        null,
        43,
        44,
        null,
        null,
        null,
        null,
        71,
        72,
        null
    ],
    [
        165,
        null,
        55,
        54,
        53,
        54,
        55,
        null,
        null,
        null,
        23,
        22,
        23,
        24,
        25,
        null,
        27,
        null,
        null,
        30,
        31,
        32,
        33,
        null,
        null,
        40,
        null,
        null,
        47,
        46,
        45,
        44,
        45,
        46,
        null,
        null,
        71,
        70,
        71,
        null
    ],
    [
        166,
        null,
        null,
        53,
        52,
        53,
        null,
        null,
        null,
        null,
        24,
        23,
        24,
        25,
        26,
        null,
        28,
        null,
        null,
        31,
        32,
        33,
        34,
        null,
        null,
        41,
        null,
        null,
        null,
        null,
        null,
        45,
        46,
        47,
        null,
        null,
        70,
        69,
        null,
        null
    ],
    [
        167,
        null,
        null,
        null,
        51,
        null,
        null,
        null,
        null,
        null,
        25,
        24,
        25,
        26,
        27,
        null,
        29,
        30,
        null,
        null,
        33,
        34,
        35,
        null,
        null,
        42,
        43,
        44,
        45,
        null,
        null,
        null,
        47,
        48,
        null,
        null,
        69,
        68,
        null,
        null
    ],
    [
        168,
        169,
        null,
        null,
        50,
        null,
        null,
        null,
        null,
        null,
        26,
        25,
        26,
        27,
        28,
        null,
        30,
        31,
        null,
        null,
        null,
        35,
        36,
        null,
        null,
        null,
        44,
        45,
        46,
        47,
        48,
        49,
        48,
        49,
        null,
        69,
        68,
        67,
        null,
        null
    ],
    [
        169,
        170,
        null,
        null,
        49,
        48,
        null,
        null,
        null,
        null,
        null,
        26,
        27,
        28,
        null,
        null,
        31,
        32,
        33,
        34,
        null,
        null,
        37,
        38,
        null,
        null,
        45,
        46,
        47,
        48,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        66,
        null,
        null
    ],
    [
        170,
        171,
        null,
        null,
        48,
        47,
        46,
        45,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        32,
        33,
        34,
        35,
        36,
        37,
        38,
        39,
        null,
        null,
        46,
        47,
        48,
        49,
        null,
        null,
        70,
        69,
        68,
        67,
        66,
        65,
        null,
        null
    ],
    [
        null,
        172,
        173,
        null,
        null,
        46,
        45,
        44,
        43,
        42,
        41,
        null,
        null,
        null,
        null,
        null,
        33,
        34,
        35,
        36,
        null,
        null,
        39,
        40,
        null,
        null,
        47,
        48,
        49,
        null,
        null,
        null,
        71,
        null,
        null,
        null,
        null,
        64,
        null,
        null
    ],
    [
        null,
        173,
        174,
        null,
        null,
        null,
        null,
        43,
        42,
        41,
        40,
        39,
        38,
        37,
        36,
        35,
        34,
        35,
        36,
        37,
        38,
        null,
        40,
        41,
        null,
        null,
        48,
        49,
        null,
        null,
        null,
        null,
        72,
        null,
        80,
        79,
        null,
        63,
        null,
        null
    ],
    [
        null,
        174,
        175,
        176,
        177,
        null,
        null,
        null,
        null,
        42,
        41,
        40,
        39,
        38,
        null,
        null,
        null,
        null,
        null,
        null,
        39,
        40,
        41,
        42,
        43,
        null,
        47,
        48,
        49,
        null,
        null,
        null,
        73,
        null,
        null,
        78,
        null,
        62,
        null,
        null
    ],
    [
        null,
        175,
        176,
        177,
        178,
        179,
        180,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        40,
        41,
        42,
        43,
        44,
        45,
        46,
        47,
        48,
        null,
        null,
        null,
        74,
        75,
        76,
        77,
        null,
        61,
        null,
        null
    ],
    [
        null,
        null,
        177,
        178,
        179,
        180,
        181,
        182,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        193,
        194,
        null,
        null,
        null,
        42,
        43,
        44,
        null,
        46,
        47,
        48,
        49,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        60,
        null,
        null
    ],
    [
        null,
        null,
        null,
        179,
        180,
        181,
        182,
        183,
        184,
        185,
        186,
        187,
        188,
        189,
        190,
        191,
        192,
        193,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        47,
        48,
        49,
        50,
        51,
        52,
        53,
        54,
        55,
        56,
        57,
        58,
        59,
        null,
        null
    ],
    [
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null
    ]
]
function interpolateColor(color1, color2, factor) {
    const r1 = parseInt(color1.slice(1, 3), 16);
    const g1 = parseInt(color1.slice(3, 5), 16);
    const b1 = parseInt(color1.slice(5, 7), 16);
    
    const r2 = parseInt(color2.slice(1, 3), 16);
    const g2 = parseInt(color2.slice(3, 5), 16);
    const b2 = parseInt(color2.slice(5, 7), 16);
    
    const r = Math.round(r1 + factor * (r2 - r1));
    const g = Math.round(g1 + factor * (g2 - g1));
    const b = Math.round(b1 + factor * (b2 - b1));
    
    return `#${(1 << 24 | r << 16 | g << 8 | b).toString(16).slice(1).toLowerCase()}`;
}
const GRID_SIZE = 40;
const colors = [...Array(GRID_SIZE)].map(x => [...Array(GRID_SIZE)])

const canvas = document.getElementById("canvas");
/**
 * @type CanvasRenderingContext2D
 */
const ctx = canvas.getContext("2d");

const {sqrt, log, floor, ceil} = Math;

let f = x => ceil(sqrt(x / 1.1));

let rarity_colors = [
    '#000',
    '#7eef6d', // c
    '#bfeb65', // C
    '#ffe65d', // u
    '#caba85', // U
    '#4d52e3', // r
    '#6a39e1', // R
    '#861fde', // e
    '#b21f7f', // E
    '#de1f1f', // l
    '#58a3a5', // L
    '#1fdbde', // m
    '#8f83aa', // M
    '#ff2b75', // x
    '#f70fb6', // X
    '#ace3df', // q
    '#97c7c4', // Q
    '#d1ab38', // au
    '#b08d25', //AU
    '#8d9ac9', //et
    '#828eb8', //ET
    '#467330', // h
    '#3e6929', // H
    '#c29c5b', // s
    '#ab8a50', // S
    '#4914a6', // n
    '#3f118f', // N
    '#3d3d3d', // inf
    '#262626', // INF
    '#852121', // cal
    '#781a1a', // CAL
    '#eeeeee', // Unique
    '#e0e0e0' // UNIQUE
    // "#000", // 0
    // "#7eef6d", // c
    // "", // C
    // "#ffe65d", // u
    // "", // U
    // "#4d52e3", // r
    // "", // R 
    // "#861fde", // e
    // "", // E
    // "#de1f1f", // l
    // "", // L
    // "#1fdbde", // m
    // "", // M
    // "ff2b75", // x
    // "#ff2b75" // X
]

const rarity_names = "_cCuUrReElLmMxX".split("");

function loop()
{
    ctx.canvas.width = innerWidth;
    ctx.canvas.height = innerHeight;

    for (let x = 0; x < GRID_SIZE; x++)
        for (let y = 0; y < GRID_SIZE; y++)
        {
            if (ds[x][y] == null)
                colors[x][y] = 0;
            else
                colors[x][y] = f(ds[x][y]);
        }
    
    const s = Math.min(innerWidth, innerHeight) / GRID_SIZE;
    ctx.scale(s, s);
    ctx.textBaseline = "middle";
    ctx.textAlign = "center";
    ctx.font = "1px";

    for (let x = 0; x < GRID_SIZE; x++)
        for (let y = 0; y < GRID_SIZE; y++)
        {
            ctx.fillStyle = rarity_colors[colors[x][y]]
            ctx.fillRect(x, y, x + 1, y + 1);
            ctx.save();
            ctx.scale(0.1, 0.1);
            ctx.translate(5, 5);
            ctx.strokeText(rarity_names[colors[x][y]], x * 10, y * 10);
            ctx.fillText  (rarity_names[colors[x][y]], x * 10, y * 10);
            ctx.restore();
        }

    requestAnimationFrame(loop);
}
loop();
